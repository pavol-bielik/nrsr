<h1><%= @deputy.firstname + " " + @deputy.lastname %></h1>

<div class="poslanec">

    <div class="foto">
        <%= image_tag("/images/photos/#{@deputy.photo}") %>
    </div>


<table>

  <tr class="row-a">
    <td class="first">Titul:</td>
    <td><%= @deputy.degree %></td>
  </tr>

  <tr class="row-b">
    <td class="first">Meno:</td>
    <td><%= @deputy.firstname %></td>
  </tr>

  <tr class="row-a">
    <td class="first">Priezvisko:</td>
    <td><%= @deputy.lastname %></td>
  </tr>

  <tr class="row-b">
    <td class="first">Kandidoval(a) za:</td>
    <td><%= @deputy.party %></td>
  </tr>

  <tr class="row-a">
    <td class="first">Dátum narodenia:</td>
    <td><%= @deputy.born %></td>
  </tr>

  <tr class="row-b">
    <td class="first">Národnosť:</td>
    <td><%= @deputy.nationality %></td>
  </tr>

  <tr class="row-a">
    <td class="first">Bydlisko:</td>
    <td><%= @deputy.domicile %></td>
  </tr>

  <tr class="row-b">
    <td class="first">Región:</td>
    <td><%= @deputy.region %></td>
  </tr>

  <% unless @deputy.email.nil? %>
  <tr class="row-a">
    <td class="first">Email:</td>
    <td><%= @deputy.email %></td>
  </tr>
  <% end %>

  <% unless @deputy.contact_person.nil? %>
  <tr class="row-a">
    <td class="first">Kont. osoba:</td>
    <td><%= @deputy.contact_person %></td>
  </tr>
  <% end %>
  
</table>

</div>

</div></div>

<h1>Graf zhody poslancov</h1><br />
<p id="choices">Vyberte si, ktore strany sa maju zobrazit:<br /></p>
<p id="overviewLegend" style="margin-left:10px"></p>

   <div id="placeholder" style="width:765px;height:300px;margin-bottom:15px"></div>
Po kliknuti na stĺpec sa zobrazia informácie o danom poslancovi<br /><br />

<b>Prehľad</b>
<div id="overview" style="margin-left:10px;width:750px;height:50px"></div>
Oznacena cast v prehlade sa zobrazi zvacsena v hlavnom okne<br />
<span id="clickdata"></span>


   <script id="source" language="javascript" type="text/javascript">
   $(function () {
   var datasets = <%= @datasets %>;
   var deputies = <%= @deputies %>;

   // hard-code color indices to prevent them from shifting as
   // countries are turned on/off
   var i = 0;
   $.each(datasets, function(key, val) {
       val.color = i;
       ++i;
   });

   // insert checkboxes
   var choiceContainer = $("#choices");
   $.each(datasets, function(key, val) {
       choiceContainer.append('<input type="checkbox" name="' + key +
                              '" checked="checked" id="id' + key + '">' +
                              '<label for="id' + key + '">'
                               + val.label + '</label>' + '| ');
   });
   choiceContainer.find("input").click(plotAccordingToChoices);


   function plotAccordingToChoices() {
       var data = [];

       choiceContainer.find("input:checked").each(function () {
           var key = $(this).attr("name");
           if (key && datasets[key])
               data.push(datasets[key]);
       });

       var options = {
              series: {
                   bars: { show: true }
               },
               grid: { hoverable: true, clickable: true },
               yaxis: { min: 0, max: 100 },
               xaxis: { tickDecimals: 0 },
              legend: {
                show: false },
               markings: [ { xaxis: { from: 0, to: 150 }, yaxis: { from: 0, to: 100 } }]
           };

       if (data.length > 0)
       var plot = $.plot($("#placeholder"), data, options);

       var overview = $.plot($("#overview"),
                data,{
            series: {
                bars: { show: true, barWidth: 1 },
                shadowSize: 0
            },
            xaxis: { ticks: [] },
            yaxis: { ticks: [], min: 0, autoscaleMargin: 0.1 },
            selection: { mode: "x" },
            legend: { show: true, noColumns: 6, container: $("#overviewLegend") }
        });


       //clickaction

       function showTooltip(x, y, id, party) {
        $('<div id="tooltip"><div class="foto" style="border-collapse: collapse;margin: 10px 15px;float: left;"><img alt="243" src="/images/photos/' + deputies[id][0] + '" /></div>\
        <table style ="border-collapse: collapse;margin: 10px 15px;float: right;">\
            <tr class="row-a">\
            <td class="first">Titul:</td>\
            <td>' + deputies[id][1] +'</td>\
            </tr>\
           <tr class="row-b">\
            <td class="first">Meno:</td>\
            <td>' + deputies[id][2] +'</td>\
          </tr>\
          <tr class="row-a">\
            <td class="first">Priezvisko:</td>\
            <td>' + deputies[id][3] +'</td>\
          </tr>\
          <tr class="row-b">\
            <td class="first">Kandidoval(a) za:</td>\
            <td>' + deputies[id][4] +'</td>\
          </tr>\
      </table>\
          </div>').css( {
            position: 'absolute',
            display: 'none',
            top: y + 5,
            left: x + 5,
            border: '2px solid #777',
            padding: '2px',
            'background-color': '#FAFAFA',
            opacity: 1
        }).appendTo("body").fadeIn(200);
    }

    var previousPoint = null;


    $("#placeholder").bind("plotclick", function (event, pos, item) {

            if (item) {
                if (previousPoint != item.datapoint) {
                    previousPoint = item.datapoint;

                    $("#tooltip").remove();

                    showTooltip(item.pageX, item.pageY, item.dataIndex, item.series.label);
                }
            }
            else {
                $("#tooltip").remove();
                previousPoint = null;
            }

        if (item) {
            $("#clickdata").text("You clicked point " + item.dataIndex + " in " + item.series.label + ".");
            plot.highlight(item.series, item.datapoint);
        }
    });


       //binding overview to plot

       $("#placeholder").bind("plotselected", function (event, ranges) {
           // do the zooming
           plot = $.plot($("#placeholder"), data,
                         $.extend(true, {}, options, {
                             xaxis: { min: ranges.xaxis.from, max: ranges.xaxis.to }
                         }));

           // don't fire event on the overview to prevent eternal loop
           overview.setSelection(ranges, true);
       });

       $("#overview").bind("plotselected", function (event, ranges) {
           plot.setSelection(ranges);
       });
       

   }

   plotAccordingToChoices();
   });
   </script>

<div><div>